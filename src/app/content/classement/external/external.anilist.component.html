@let baseText = 'generator.external.anilist.';

<mg-dialog closeButton [closeButtonTitle]="'generic.dialog.close' | transloco">
  <h2>{{ baseText + 'title' | transloco }}</h2>

  @if (searchAnilistForm) {
    <div class="import-form">
      <img class="logo" src="./assets/images/anilit_icon.svg" />
      <form [formGroup]="searchAnilistForm" (submit)="search()">
        <mg-input class="s-12">
          <mg-input-label>{{ baseText + 'name' | transloco }}</mg-input-label>
          <mg-input-text formControlName="query" />
        </mg-input>
        <mg-input class="s-12">
          <mg-input-label>{{ baseText + 'type.media' | transloco }}</mg-input-label>
          <mg-input-radio formControlName="type" value="ANIME">{{
            baseText + 'type.anime' | transloco
          }}</mg-input-radio>
          <mg-input-radio formControlName="type" value="MANGA">{{
            baseText + 'type.manga' | transloco
          }}</mg-input-radio>
        </mg-input>

        <p class="buttons">
          <button type="submit" [disabled]="!searchAnilistForm.get('query')?.value.trim()">
            {{ baseText + 'search' | transloco }}
          </button>
        </p>
      </form>
      @if (results?.length) {
        <div class="options">
          <div>
            <div class="s-12">
              <mg-input>
                <mg-input-checkbox [(ngModel)]="withTitle">
                  {{ baseText + 'with.title' | transloco }}
                </mg-input-checkbox>
              </mg-input>
              @if (withTitle) {
                <mg-input>
                  <mg-input-checkbox [(ngModel)]="withYear">
                    {{ baseText + 'with.year' | transloco }}
                  </mg-input-checkbox>
                </mg-input>
              }
            </div>

            @if (withTitle) {
              <mg-input class="s-6">
                <mg-input-label>{{ baseText + 'for.title.choice' | transloco }}</mg-input-label>
                <mg-input-select
                  [data]="[
                    { value: 'english', label: baseText + 'for.title.english' | transloco },
                    { value: 'romaji', label: baseText + 'for.title.romaji' | transloco },
                    { value: 'native', label: baseText + 'for.title.native' | transloco },
                  ]"
                  [(ngModel)]="titleSource"
                />
              </mg-input>
            }

            <mg-input class="s-6">
              <mg-input-label>{{ baseText + 'annotation' | transloco }}</mg-input-label>
              <mg-input-checkbox value="english" [(ngModel)]="include">{{
                baseText + 'for.title.english' | transloco
              }}</mg-input-checkbox>
              <mg-input-checkbox value="romaji" [(ngModel)]="include">{{
                baseText + 'for.title.romaji' | transloco
              }}</mg-input-checkbox>
              <mg-input-checkbox value="native" [(ngModel)]="include">{{
                baseText + 'for.title.native' | transloco
              }}</mg-input-checkbox>
            </mg-input>
          </div>
        </div>
      }
      <div class="tiles">
        @for (ani of results; track ani) {
          <div class="content-box" [class.disabled]="ani.disabled" (click)="addTile(ani)">
            <div class="content">
              <img [src]="baseImg + ani.coverImage?.extraLarge" alt="poster_path" />
              <div class="tile-title">
                @if (withTitle) {
                  <span>{{
                    titleSource === 'english'
                      ? ani.title.english || ani.title.romaji
                      : titleSource === 'romaji'
                        ? ani.title.romaji || ani.title.english
                        : ani.title.native || ani.title.romaji || ani.title.english
                  }}</span>
                }
                @if (withYear) {
                  <span> ({{ ani.startDate.year }})</span>
                }
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  }
</mg-dialog>
