@let baseText = 'generator.external.imdb.';

<mg-dialog closeButton [closeButtonTitle]="'generic.dialog.close' | transloco">
  <h2>{{ baseText + 'title' | transloco }}</h2>

  @if (keyApi && languages && searchMovieForm) {
    <div class="import-form">
      <img class="logo" src="./assets/images/imdb_blue_square_2.svg" />
      <form [formGroup]="searchMovieForm" (submit)="search()">
        <mg-input class="s-12">
          <mg-input-label>{{ baseText + 'name' | transloco }}</mg-input-label>
          <mg-input-text formControlName="query" />
        </mg-input>
        <mg-input class="s-12">
          <mg-input-checkbox formControlName="include_adult">{{
            baseText + 'adult.content' | transloco
          }}</mg-input-checkbox>
        </mg-input>
        <mg-input class="s-12">
          <mg-input-label>{{ baseText + 'name' | transloco }}</mg-input-label>
          <mg-input-select overlay id="language" formControlName="language" [data]="languages" />
        </mg-input>
        <p class="buttons">
          <button type="submit" [disabled]="!searchMovieForm.get('query')?.value.trim()">
            {{ baseText + 'search' | transloco }}
          </button>
        </p>
      </form>
      @if (results?.length) {
        <div class="options">
          <div>
            <mg-input>
              <mg-input-checkbox [(ngModel)]="withTitle"> {{ baseText + 'with.title' | transloco }}</mg-input-checkbox>
            </mg-input>
            <mg-input>
              <mg-input-checkbox [(ngModel)]="withYear"> {{ baseText + 'with.year' | transloco }}</mg-input-checkbox>
            </mg-input>
          </div>
        </div>
      }
      <div class="tiles">
        @for (movie of results; track movie) {
          @if (movie.poster_path) {
            <div class="content-box" [class.disabled]="movie.disabled" (click)="addTile(movie)">
              <div class="content">
                <img [src]="baseImg + movie.poster_path" alt="poster_path" />
                <div class="tile-title">
                  @if (withTitle) {
                    <span>{{ movie.title }}</span>
                  }
                  @if (withYear) {
                    <span> ({{ movie.release_date | date: 'YYYY' }})</span>
                  }
                </div>
              </div>
            </div>
          }
        }
      </div>
    </div>
  }
</mg-dialog>
