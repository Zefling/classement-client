<h3>{{ 'generator.options.group.title' | translate }}</h3>

@let opts = options();

@if (opts) {
  <div class="options {{ opts.mode }}" [class.simplified]="!opts.showAdvancedOptions">
    <div class="title">
      <label for="option-title">{{ 'generator.options.title' | translate }}</label>
      <div><input for="option-title" type="text" maxlength="150" [(ngModel)]="opts.title" /></div>
    </div>
    <div class="categories">
      <label for="option-category">{{ 'generator.options.group' | translate }}</label>
      <div>
        <select2
          id="option-category"
          [data]="categoriesList"
          [disabled]="lockCategory()"
          [(ngModel)]="opts.category"
        ></select2>
      </div>
    </div>
    <div class="modes">
      <label for="option-mode">{{ 'generator.options.mode' | translate }}</label>
      <select2
        #mode
        id="option-mode"
        [ngModel]="opts.mode"
        (ngModelChange)="modeChange(opts.mode, $event)"
        [data]="listMode"
        [templates]="templateMode"
      >
        <ng-template #templateMode let-label="label" let-data="data">
          <div class="list-mode">
            <div class="view"><span [ngClass]="'icon-mode-' + data.icon"></span></div>
            <div class="desc">
              {{ 'mode.name.' + label | translate }}
            </div>
          </div>
        </ng-template>
      </select2>
    </div>
    <div class="description">
      <label for="option-description">{{ 'generator.options.description' | translate }}</label>
      <div>
        <textarea id="option-description" autosize maxlength="1000" [(ngModel)]="opts.description"></textarea>
        <div class="info-desc">
          @if (1000 - ((opts.description && opts.description.length) || 0) < 200) {
            <span> {{ 1000 - opts.description.length }} - </span>
          }
          <span>Markdown</span>
        </div>
      </div>
    </div>
    <div class="links">
      <a tabindex="0" (click)="switchOptions()">{{
        (opts.showAdvancedOptions ? 'generator.options.simple' : 'generator.options.advance') | translate
      }}</a>
    </div>
    <div class="themes">
      <a tabindex="0" (click)="themesOpen()">{{ 'generator.theme.link' | translate }}</a>
    </div>
    <div class="width-auto">
      <label class="toggle-switch">
        <input type="checkbox" [(ngModel)]="opts.itemWidthAuto" />
        <span>{{ 'generator.options.item.width.auto' | translate }}</span>
      </label>
      @if (zoneMode.includes(opts.mode)) {
        <label class="toggle-switch">
          <input type="checkbox" [(ngModel)]="opts.itemHeightAuto" />
          <span>{{ 'generator.options.item.height.auto' | translate }}</span>
        </label>
      }
      @if (
        !opts.itemWidthAuto && (!zoneMode.includes(opts.mode) || (zoneMode.includes(opts.mode) && !opts.itemHeightAuto))
      ) {
        <label class="toggle-switch">
          <input type="checkbox" [(ngModel)]="opts.itemImageCover" />
          <span>{{ 'generator.options.item.cover' | translate }}</span>
        </label>
      }
    </div>
    <div class="stream-mode">
      <label class="toggle-switch">
        <input type="checkbox" [(ngModel)]="opts.streamMode" />
        <span>{{ 'generator.options.stream.mode' | translate }}</span>
        <span [tooltip]="'generator.options.stream.mode.info' | translate" class="icon-info"></span>
      </label>
    </div>
    @if (opts.showAdvancedOptions) {
      <!-- ###############################  tile options ############################### -->
      <h4 class="title-item">{{ 'generator.options.item.title' | translate }}</h4>
      <div class="sizes">
        <label for="option-item-margin">{{ 'generator.options.sizes' | translate }}</label>
        <div class="item-options">
          <div class="box-border"></div>
          <div class="box-in"></div>
          <div class="height"></div>
          <div class="width"></div>
          <label for="option-item-margin" class="margin">{{ 'generator.options.margin' | translate }}</label>
          <input
            id="option-item-margin"
            type="number"
            min="0"
            max="20"
            class="item-margin"
            [(ngModel)]="opts.itemMargin"
            title="{{ 'generator.options.item.margin' | translate }}"
          />
          <label for="option-item-border" class="border">
            <span>{{ 'generator.options.border' | translate }}</span>
          </label>
          <input
            id="option-item-border"
            type="number"
            min="0"
            max="20"
            class="item-border"
            [(ngModel)]="opts.itemBorder"
            title="{{ 'generator.options.item.border' | translate }}"
          />
          <label for="option-item-padding" class="padding">{{ 'generator.options.padding' | translate }}</label>
          <input
            id="option-item-padding"
            type="number"
            min="0"
            max="20"
            class="item-padding"
            [(ngModel)]="opts.itemPadding"
            title="{{ 'generator.options.item.padding' | translate }}"
          />
          @if (!opts.itemHeightAuto) {
            <input
              id="option-item-height"
              type="number"
              min="16"
              max="300"
              class="item-height"
              [(ngModel)]="opts.itemHeight"
              (ngModelChange)="updateSize('itemHeight', 16)"
              title="{{ 'generator.options.item.height' | translate }}"
            />
          } @else {
            <span id="option-item-height-auto-info" class="item-height input">auto</span>
          }
          @if (opts.itemHeightAuto) {
            <input
              id="option-item-max-height"
              type="number"
              min="150"
              max="300"
              class="item-max-height"
              [(ngModel)]="opts.itemMaxWidth"
              (ngModelChange)="updateSize('itemMaxHeight', 100)"
              title="{{ 'generator.options.item.max.height' | translate }}"
            />
          }
          <span class="image">{{ 'generator.options.image' | translate }}</span>
          @if (!opts.itemWidthAuto) {
            <input
              id="option-item-width"
              type="number"
              min="16"
              max="300"
              class="item-width"
              [(ngModel)]="opts.itemWidth"
              (ngModelChange)="updateSize('itemWidth', 16)"
              title="{{ 'generator.options.item.width' | translate }}"
            />
          } @else {
            <span id="option-item-width-auto-info" class="item-width input">auto</span>
          }
          @if (opts.itemWidthAuto) {
            <input
              id="option-item-max-width"
              type="number"
              min="150"
              max="300"
              class="item-max-width"
              [(ngModel)]="opts.itemMaxWidth"
              (ngModelChange)="updateSize('itemMaxWidth', 100)"
              title="{{ 'generator.options.item.max.width' | translate }}"
            />
          }
        </div>
        <div>
          <label class="toggle-switch">
            <input id="option-item-width-auto" type="checkbox" [(ngModel)]="opts.itemWidthAuto" />
            <span>{{ 'generator.options.item.width.auto' | translate }}</span>
          </label>
          @if (zoneMode.includes(opts.mode)) {
            <label class="toggle-switch">
              <input id="option-item-height-auto" type="checkbox" [(ngModel)]="opts.itemHeightAuto" />
              <span>{{ 'generator.options.item.height.auto' | translate }}</span>
            </label>
          }
        </div>
      </div>
      @if (opts.itemTextPosition && opts.itemTextPosition.endsWith('over')) {
        <div class="item-text-back input-button">
          <div class="color">
            <label for="option-item-text-background-color">{{
              'generator.options.item.text.background.color' | translate
            }}</label>
            <input id="option-item-text-background-color" type="color" [(ngModel)]="opts.itemTextBackgroundColor" />
          </div>
          <div class="opacity">
            <label id="option-item-text-background-opacity">{{
              'generator.options.item.text.background.opacity' | translate
            }}</label>
            <input
              id="option-item-text-background-opacity"
              type="range"
              max="100"
              min="0"
              step="1"
              [disabled]="!opts.itemTextBackgroundColor"
              [(ngModel)]="opts.itemTextBackgroundOpacity"
            />
          </div>
          <button (click)="resetItemTextBackground()" [disabled]="!opts.itemTextBackgroundColor">
            {{ 'generator.options.clear' | translate }}
          </button>
          @if (opts.itemTextBackgroundColor) {
            <div class="color-render"></div>
          }
        </div>
      }
      <div class="colors-item-back input-button">
        <div class="color">
          <label for="itemBackgroundColor">{{ 'generator.options.item.background.color' | translate }}</label>
          <input id="itemBackgroundColor" type="color" [(ngModel)]="opts.itemBackgroundColor" />
        </div>
        <div class="opacity">
          <label for="itemBackgroundOpacity">{{ 'generator.options.item.background.opacity' | translate }}</label>
          <input
            id="itemBackgroundOpacity"
            type="range"
            max="100"
            min="0"
            step="1"
            [disabled]="!opts.itemBackgroundColor"
            [(ngModel)]="opts.itemBackgroundOpacity"
          />
        </div>
        <button (click)="resetItemBackground()" [disabled]="!opts.itemBackgroundColor">
          {{ 'generator.options.clear' | translate }}
        </button>
        @if (opts.itemBackgroundColor) {
          <div class="color-render"></div>
        }
      </div>
      <div class="colors-item-border input-button">
        <div class="color">
          <label for="itemBorderColor">{{ 'generator.options.item.border.color' | translate }}</label>
          <input id="itemBorderColor" type="color" [(ngModel)]="opts.itemBorderColor" />
        </div>
        <div class="opacity">
          <label for="itemBorderOpacity">{{ 'generator.options.item.border.opacity' | translate }}</label>
          <input
            id="itemBorderOpacity"
            type="range"
            max="100"
            min="0"
            step="1"
            [disabled]="!opts.itemBorderColor"
            [(ngModel)]="opts.itemBorderOpacity"
          />
        </div>
        <button (click)="resetItemBorder()" [disabled]="!opts.itemBorderColor">
          {{ 'generator.options.clear' | translate }}
        </button>
        @if (opts.itemBorderColor) {
          <div class="color-render"></div>
        }
      </div>
      <div class="size-item-text input-button">
        <div class="color">
          <label for="itemTextSize">{{ 'generator.options.item.text.size' | translate }}</label>
          <input id="itemTextSize" type="number" min="6" max="100" [(ngModel)]="opts.itemTextSize" />
        </div>
      </div>
      <div class="colors-item-text input-button">
        <div class="width-input">
          <label for="option-item-text-color">{{ 'generator.options.item.text.color' | translate }}</label>
          <input id="option-item-text-color" type="color" [(ngModel)]="opts.itemTextColor" />
        </div>
        <div class="opacity">
          <label for="option-item-text-opacity">{{ 'generator.options.item.text.opacity' | translate }}</label>
          <input
            for="option-item-text-opacity"
            type="range"
            max="100"
            min="0"
            step="1"
            [disabled]="!opts.itemTextColor"
            [(ngModel)]="opts.itemTextOpacity"
          />
        </div>
        <button (click)="resetItemText()" [disabled]="!opts.itemTextColor">
          {{ 'generator.options.clear' | translate }}
        </button>
        @if (opts.itemTextColor) {
          <div class="color-render"></div>
        }
      </div>
      <div class="item-text-position input-value">
        <div class="select-input">
          <label for="option-item-text-position">{{ 'generator.options.item.text.position' | translate }}</label>
          <select id="option-item-text-position" [(ngModel)]="opts.itemTextPosition">
            <option value="bottom">{{ 'generator.options.item.text.position.bottom' | translate }}</option>
            <option value="bottom-over">
              {{ 'generator.options.item.text.position.bottom.over' | translate }}
            </option>
            <option value="bottom-over-hover">
              {{ 'generator.options.item.text.position.bottom.over.hover' | translate }}
            </option>
            <option value="top">{{ 'generator.options.item.text.position.top' | translate }}</option>
            <option value="top-over">{{ 'generator.options.item.text.position.top.over' | translate }}</option>
            <option value="top-over-hover">
              {{ 'generator.options.item.text.position.top.over.hover' | translate }}
            </option>
            <option value="hidden">{{ 'generator.options.item.text.position.hidden' | translate }}</option>
          </select>
        </div>
      </div>
      <!-- ###############################  line options ###############################  -->
      @if (!zoneMode.includes(opts.mode)) {
        <h4 class="title-line">{{ 'generator.options.line.title' | translate }}</h4>
        <div class="colors-line-back input-button">
          <div class="color">
            <label for="option-line-background-color">{{
              'generator.options.line.background.color' | translate
            }}</label>
            <input id="option-line-background-color" type="color" [(ngModel)]="opts.lineBackgroundColor" />
          </div>
          <div class="opacity">
            <label for="option-line-background-opacity">{{
              'generator.options.line.background.opacity' | translate
            }}</label>
            <input
              for="option-line-background-opacity"
              type="range"
              max="100"
              min="0"
              step="1"
              [disabled]="!opts.lineBackgroundColor"
              [(ngModel)]="opts.lineBackgroundOpacity"
            />
          </div>
          <button (click)="resetLineBackground()" [disabled]="!opts.lineBackgroundColor">
            {{ 'generator.options.clear' | translate }}
          </button>
          @if (opts.lineBackgroundColor) {
            <div class="color-render"></div>
          }
        </div>
        <div class="colors-line-border input-button">
          <div class="color">
            <label for="option-line-border-color">{{ 'generator.options.line.border.color' | translate }}</label>
            <input id="option-line-border-color" type="color" [(ngModel)]="opts.lineBorderColor" />
          </div>
          <div class="opacity">
            <label for="option-line-border-opacity">{{ 'generator.options.line.border.opacity' | translate }}</label>
            <input
              id="option-line-border-opacity"
              type="range"
              max="100"
              min="0"
              step="1"
              [disabled]="!opts.lineBorderColor"
              [(ngModel)]="opts.lineBorderOpacity"
            />
          </div>
          <button (click)="resetLineBorder()" [disabled]="!opts.lineBorderColor">
            {{ 'generator.options.clear' | translate }}
          </button>
          @if (opts.lineBorderColor) {
            <div class="color-render"></div>
          }
        </div>
        <div class="name-bg-opacity input-value">
          <div class="width-input">
            <label for="options-name-background-opacity">{{ 'generator.options.name.opacity' | translate }}</label>
            <input
              id="options-name-background-opacity"
              type="range"
              max="100"
              min="0"
              step="1"
              [(ngModel)]="opts.nameBackgroundOpacity"
            />
          </div>
        </div>
        <div class="font-size input-value">
          <div class="number-input">
            <label for="option-name-font-size">{{ 'generator.options.name.font-size' | translate }}</label>
            <input id="option-name-font-size" type="number" min="50" max="300" [(ngModel)]="opts.nameFontSize" />
          </div>
        </div>
        <div class="name-width input-value">
          <div class="number-input">
            <label for="option-name-width">{{ 'generator.options.name.width' | translate }}</label>
            <input id="option-name-width" type="number" [(ngModel)]="opts.nameWidth" />
          </div>
        </div>
        <div class="group-direction input-value">
          <div class="select-input">
            <label for="option-group-direction">{{ 'generator.options.group.direction.label' | translate }}</label>
            <select id="option-item-text-position" [(ngModel)]="opts.direction">
              <option value="rtl">{{ 'generator.options.group.direction.rtl' | translate }}</option>
              <option value="ltr">{{ 'generator.options.group.direction.ltr' | translate }}</option>
            </select>
          </div>
        </div>
        <div class="name-markdown input-value">
          <label class="toggle-switch">
            <input type="checkbox" [(ngModel)]="opts.nameMarkdown" />
            <span>{{ 'generator.options.group.markdown' | translate }}</span>
          </label>
        </div>
      }
      @if (opts.mode === 'iceberg') {
        <h4 class="title-line">{{ 'generator.options.line.title' | translate }}</h4>
        <div class="zone-title-number">
          <div class="width-input">
            <label for="option-groups-size">{{ 'generator.options.zone.title.number' | translate }}</label>
            <input
              id="option-groups-size"
              type="number"
              [ngModel]="opts.groups?.length || 0"
              (ngModelChange)="updateListGroup($event)"
            />
          </div>
        </div>
        <div class="zone-title-groups">
          @for (item of opts.groups; track item) {
            <div>
              <div class="width-input">
                <label for="option-title-name">{{ 'generator.options.zone.title.name' | translate }}</label>
                <input id="option-title-name" type="text" [(ngModel)]="item.title" />
              </div>
              <div class="width-input">
                <label for="option-title-align-vertical">{{
                  'generator.options.zone.title.align.vertical.label' | translate
                }}</label>
                <select id="option-title-align-vertical" [(ngModel)]="item.titleVerticalPosition">
                  <option value="start">
                    {{ 'generator.options.zone.title.align.vertical.start' | translate }}
                  </option>
                  <option value="center">
                    {{ 'generator.options.zone.title.align.vertical.center' | translate }}
                  </option>
                  <option value="end">
                    {{ 'generator.options.zone.title.align.vertical.end' | translate }}
                  </option>
                </select>
              </div>
              <div class="width-input">
                <label for="option-title-align-horizontal">{{
                  'generator.options.zone.title.align.horizontal.label' | translate
                }}</label>
                <select id="option-title-align-horizontal" [(ngModel)]="item.titleHorizontalPosition">
                  <option value="start">
                    {{ 'generator.options.zone.title.align.horizontal.start' | translate }}
                  </option>
                  <option value="center">
                    {{ 'generator.options.zone.title.align.horizontal.center' | translate }}
                  </option>
                  <option value="end">
                    {{ 'generator.options.zone.title.align.horizontal.end' | translate }}
                  </option>
                </select>
              </div>
            </div>
          }
        </div>
        <div class="group-line-width input-value">
          <div class="number-input">
            <label for="option-group-line-width">{{ 'generator.options.separator.line.width' | translate }}</label>
            <input id="option-group-line-width" type="number" min="0" max="50" [(ngModel)]="opts.groupLineSize" />
          </div>
        </div>
        <div class="colors-group-line input-button">
          <div class="width-input">
            <label for="option-title-color">{{ 'generator.options.separator.line.color' | translate }}</label>
            <input id="option-title-color" type="color" [(ngModel)]="opts.groupLineColor" />
          </div>
          <div class="opacity">
            <label for="option-title-opacity">{{ 'generator.options.separator.line.opacity' | translate }}</label>
            <input
              for="option-title-opacity"
              type="range"
              max="100"
              min="0"
              step="1"
              [disabled]="!opts.groupLineColor"
              [(ngModel)]="opts.groupLineOpacity"
            />
          </div>
          <button (click)="resetTitleText()" [disabled]="!opts.groupLineColor">
            {{ 'generator.options.clear' | translate }}
          </button>
          @if (opts.groupLineColor) {
            <div class="color-render"></div>
          }
        </div>
      }
      @if (opts.mode === 'axis') {
        <h4 class="title-line">{{ 'generator.options.line.title' | translate }}</h4>
        <div class="zone-title-axis">
          @for (item of opts.groups; track item; let index = $index) {
            <div>
              <div class="width-input">
                <label for="option-title-name">{{
                  (index % 2 === 0 ? 'generator.options.zone.axis.name' : 'generator.options.zone.area.name')
                    | translate
                }}</label>
                <input id="option-title-name" type="text" [(ngModel)]="item.title" />
              </div>
            </div>
          }
        </div>
        <div class="axis-line-width input-value">
          <div class="number-input">
            <label for="option-axis-line-width">{{ 'generator.options.axis.line.width' | translate }}</label>
            <input id="option-axis-line-width" type="number" min="0" max="12" [(ngModel)]="opts.axisLineWidth" />
          </div>
        </div>
        <div class="axis-arrow-size number-input">
          <label for="option-axis-arrow-size">{{ 'generator.options.axis.arrow.size' | translate }}</label>
          <input id="option-axis-arrow-size" type="number" min="0" max="50" [(ngModel)]="opts.axisArrowWidth" />
        </div>
        <div class="colors-axis-line input-button">
          <div class="width-input">
            <label for="option-axis-line-color">{{ 'generator.options.axis.line.color' | translate }}</label>
            <input id="option-axis-line-color" type="color" [(ngModel)]="opts.axisLineColor" />
          </div>
          <div class="opacity">
            <label for="option-axis-line-opacity">{{ 'generator.options.item.text.opacity' | translate }}</label>
            <input
              for="option-axis-line-opacity"
              type="range"
              max="100"
              min="0"
              step="1"
              [disabled]="!opts.axisLineColor"
              [(ngModel)]="opts.axisLineOpacity"
            />
          </div>
          <button (click)="resetAxisLine()" [disabled]="!opts.axisLineColor">
            {{ 'generator.options.clear' | translate }}
          </button>
          @if (opts.axisLineColor) {
            <div class="color-render"></div>
          }
        </div>
      }
      <!-- ###############################  other options ###############################  -->
      <h4 class="title-other">{{ 'generator.options.global.title' | translate }}</h4>
      <div class="colors-title-text input-button">
        <div class="width-input">
          <label for="option-title-color">{{ 'generator.options.title.color' | translate }}</label>
          <input id="option-title-color" type="color" [(ngModel)]="opts.titleTextColor" />
        </div>
        <div class="opacity">
          <label for="option-title-opacity">{{ 'generator.options.title.opacity' | translate }}</label>
          <input
            for="option-title-opacity"
            type="range"
            max="100"
            min="0"
            step="1"
            [disabled]="!opts.titleTextColor"
            [(ngModel)]="opts.titleTextOpacity"
          />
        </div>
        <button (click)="resetTitleText()" [disabled]="!opts.titleTextColor">
          {{ 'generator.options.clear' | translate }}
        </button>
        @if (opts.titleTextColor) {
          <div class="color-render"></div>
        }
      </div>
      <div class="global-width input-button">
        <div class="width-input">
          <label for="option-global-width">{{ 'generator.options.global.width' | translate }}</label>
          <input id="option-global-width" type="number" [(ngModel)]="opts.imageWidth" />
        </div>
      </div>
      @if (zoneMode.includes(opts.mode)) {
        <div class="global-height input-button">
          <div class="width-input">
            <label for="option-global-height">{{ 'generator.options.global.height' | translate }}</label>
            <input id="option-global-height" type="number" [(ngModel)]="opts.imageHeight" />
          </div>
        </div>
      }
      <div class="background-image">
        <div class="width-input">
          <label for="backgroundImage">{{ 'generator.options.global.image' | translate }}</label>
          <div class="image-list">
            <select2
              [(ngModel)]="opts.imageBackgroundImage"
              [data]="listThemes"
              [templates]="templates"
              resultMaxHeight="300px"
            >
              <ng-template #templates let-data="data">
                <div class="list-option">
                  <div class="view" [style.--url]="data.image"></div>
                  <div class="desc">
                    {{ 'generator.options.global.name.image.' + data.label | translate }}
                  </div>
                </div>
              </ng-template>
            </select2>
          </div>
        </div>
      </div>
      <div class="global-color input-button">
        <div class="color">
          <label for="option-global-background-color">{{ 'generator.options.global.background' | translate }}</label>
          <input id="option-global-background-color" type="color" [(ngModel)]="opts.imageBackgroundColor" />
        </div>
        <button (click)="opts.imageBackgroundColor = ''" [disabled]="!opts.imageBackgroundColor">
          {{ 'generator.options.clear' | translate }}
        </button>
        @if (opts.imageBackgroundColor) {
          <div class="color-render"></div>
        }
      </div>
      @if (opts.imageBackgroundImage === 'custom') {
        <div class="background-image-custom" drop-image mode="local" (file)="changeCustomBackground($event)">
          <label class="required">{{ 'generator.options.background.custom' + (api ? '.api' : '') | translate }}</label>
          <input type="file" accept="image/*" required (change)="changeCustomBackgroundEvent($event)" />
          <div>
            @if (opts.imageBackgroundCustom) {
              <img [src]="opts.imageBackgroundCustom" class="image-custom" />
            }
          </div>
        </div>
      }
    }
    <div class="tags">
      {{ 'generator.options.tags' | translate }}
      <tag-list [tags]="opts.tags" (update)="updateTags($event)"></tag-list>
    </div>
  </div>
}

<classement-themes (change)="changeTheme($event)" [themes]="themes"></classement-themes>

<dialog-cmp class="auto-format" #dialogChangeMode>
  <p class="question">
    {{ 'generator.actions.change.mode.question' | translate }}
  </p>
  <p class="info">
    <strong>{{ 'mode.name.' + _modeTemp | translate }}</strong>
    <span>{{ 'generator.actions.change.mode.' + _modeTemp | translate }}</span>
  </p>

  <div class="buttons">
    <button (click)="modeChangeValid(false)">
      {{ 'generator.actions.reset.groups.cancel' | translate }}
    </button>
    <button class="primary" (click)="modeChangeValid(true)">
      {{ 'generator.actions.reset.groups.ok' | translate }}
    </button>
  </div>
</dialog-cmp>
